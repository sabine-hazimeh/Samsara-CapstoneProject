<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Shop</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="stylesheet"  th:href="@{/css/style.css}" />
    <link rel="stylesheet"  th:href="@{/css/site.css}" />
    <link rel="stylesheet" th:href="@{/css/helper.css}" />
    <link rel="stylesheet" th:href="@{/css/plugins.css}" />
    <link rel="stylesheet" th:href="@{/css/app.min.css}" />
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" />
    <link rel="stylesheet" th:href="@{/css/custom.min.css}" />
    <style>
        #sortByStatus,
        #sortByPrice {
            border: 1px solid #ced4da; /* Matching border color */
            border-radius: 4px; /* Matching border radius */
            padding-top: 20px; /* Matching padding */
            padding-bottom: 20px;
            width: 300px; /* Full width */
            color: #495057; /* Matching text color */
            background-color: inherit; /* Matching background color */
        }
        /* CSS for Sold Out label */
.sold-out-label {
    background-color: #405189;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-weight: bold;
    position: absolute;
    top: 10px;
    right: 10px;
}

/* CSS for disabled appearance */
.property-item.sold-out {
    opacity: 0.6; /* Reduce opacity for the disabled appearance */
    pointer-events: none; /* Disable pointer events */
}

    /* Add this CSS to change the size and position of the delete icon */
     .delete {
        position: relative;
    }

    .delete button {
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        border: none;
        background: transparent;
    }

    .delete button i {
        font-size: 24px; /* Adjust the font size as per your requirement */
    }


    </style>
</head>
<body>
<div th:replace="fragment/header :: header"></div>
<div id="main-wrapper">

    <!--Search Section start-->
    <div class="search-section section pt-100 pt-lg-80 pt-md-70 pt-sm-60 pt-xs-50 pb-100 pb-lg-80 pb-md-70 pb-sm-60 pb-xs-50">
        <div class="container">

            <!--Section Title start-->
            <div class="row">
                <div class="col-md-12 mb-60 mb-xs-30">
                    <div class="section-title center">
                        <h1>Find Your Home</h1>
                    </div>
                </div>
            </div>
            <!--Section Title end-->
            <a th:href="@{/post/add-post}">
                <button type="button" style="color:#E8B524" class="btn btn-primary btn-lg m-3">Add Apartment</button>
            </a>
            <div class="row">
                <div class="col">

                    <!--Property Search start-->
                    <div class="property-search">

                        <form action="#" th:action="@{/search/posts}" method="get">
                            <div>
                                <input type="text" placeholder="Location" name="location">
                            </div>

                            <div>
                                <input type="number" class="nice-input" placeholder="Number of Bedrooms" name="bedroomNb"/>
                            </div>

                            <div>
                                <input type="number" class="nice-input" placeholder="Number of Bathrooms" name="bathroomNb"/>
                            </div>

                            <div>
                                <button type="submit">search</button>
                            </div>

                        </form>
                        <div class="row pt-4" >
                            <div class="col">
                                <form action="#" method="get" id="sortPriceForm">
                                    <div class="form-group">
                                        <select class="form-control" id="sortByPrice">
                                            <option value="" disabled selected>Filter by Price</option>
                                            <option value="lowToHigh">Low to High</option>
                                            <option value="highToLow">High to Low</option>
                                        </select>
                                    </div>
                                </form>
                            </div>
                            <div class="col">
                                <form action="#" method="get" id="sortByStatusForm">
                                    <div class="form-group">
                                        <select class="form-control" id="sortByStatus">
                                            <option value="" disabled selected>Sort by Status</option>
                                            <option value="Rent">Rent</option>
                                            <option value="Sale">Sale</option>
                                        </select>
                                    </div>
                                </form>
                            </div>
                        </div>

                    </div>
                </div>
                <!--Property Search end-->
            </div>
        </div>
    </div>


</div>
<!--Search Section section end-->

<!--New property section start-->
<div class="property-section section pb-60 pb-lg-40 pb-md-30 pb-sm-20 pb-xs-10">
    <div class="container">

        <!--Section Title start-->
        <div class="row">
            <div class="col-md-12 mb-60 mb-xs-30">
                <div class="section-title center">
                    <h1>Search results</h1>
                </div>
            </div>
        </div>
        <!--            Section Title end-->

        <div class="row">
            <!-- Iterate over the list of Apartments -->
            <div th:each="post : ${posts}" class="property-item mb-40 col-4"  th:classappend="${!post.available} ? 'sold-out' : ''">
                <a th:href="@{/Post/view-post-Detail/{ID}(ID=${post.id})}">
                    <div class="property-inner ">
                        <div class="image">
                            <div th:each="image : ${post.images}">
                                <td>
                                    <img alt="" th:src="'data:image/jpeg;base64,' + ${image.image}">
                                </td>
                            </div>


                            <ul class="property-feature">
                                <li>
                                        <span class="area">
                                            <img src="http://drive.google.com/uc?export=view&id=12pl1CMox-BSLAmQ43G_9-eTuiE0oJOH6" alt="" th:text="${post.area}"></span>
                                </li>
                                <li>
                                        <span class="bed">
                                            <img src="http://drive.google.com/uc?export=view&id=1lWwcNolnIGzhKA44SFGJx57lYDzI7TE8" alt="" th:text="${post.bedroomNb}"></span>
                                </li>
                                <li>
                                        <span class="bath">
                                            <img src="http://drive.google.com/uc?export=view&id=1_6GbQnj30rmjc8OwXe7bgb5dh8I4sUE1" alt="" th:text="${post.bathroomNb}"></span>
                                </li>
                            </ul>
                        </div>
                        <div class="content">
                            <div class="left">
                                    <span class="location">
                                        <img src="http://drive.google.com/uc?export=view&id=1HGbxyuvjC1-SSh4Nrbpvx7v_AOb5QhmN" alt="" th:text="${post.location}"></span>
                            </div>
                            <div class="right">
                                <div class="type-wrap">
                                        <span class="price" th:text="${post.price}">
                                            <p>$</p>
                                        </span>
                                    <span class="type" th:text="${post.status}"></span>
                                    <span th:if="${!post.available}" class="sold-out-label">Sold Out</span>
                                </div>
                            </div>
                            <div class="wishlist">
                                <form th:action="@{/wish/add/{postId}(postId=${post.id})}" method="post">
                                    <button type="submit" style="border:none; background: transparent;"><i class="far fa-heart"></i></button>
                                </form>
                            </div>
<!--                            <div class="delete">-->
<!--                            <form th:action="@{/Employee/delete-post/{postId}(postId=${post.id})}" method="post" onsubmit="return confirm('Are you sure you want to delete this post?');">-->
<!--                                <button type="submit" style="border: none; background: transparent;"><i class="fas fa-trash"></i></button>-->
<!--                            </form>-->
<!--                        </div>-->
                            <div class="delete">
                                <form th:action="@{/Employee/delete-post/{postId}(postId=${post.id})}" method="post" onsubmit="return confirm('Are you sure you want to delete this post?');">
                                    <button type="submit" style="border: none; background: transparent;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        </div>

    </div>
</div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $('#sortByPrice').on('change', function () {
            var selectedOption = $(this).val();
            var propertyItems = $('.property-item').toArray(); // Convert jQuery object to an array

            if (selectedOption === 'lowToHigh') {
                propertyItems.sort(function (a, b) {
                    var priceA = parseFloat($(a).find('.price').text().replace('$', ''));
                    var priceB = parseFloat($(b).find('.price').text().replace('$', ''));
                    return priceA - priceB;
                });
            } else if (selectedOption === 'highToLow') {
                propertyItems.sort(function (a, b) {
                    var priceA = parseFloat($(a).find('.price').text().replace('$', ''));
                    var priceB = parseFloat($(b).find('.price').text().replace('$', ''));
                    return priceB - priceA;
                });
            }

            // Empty the container before appending sorted rows
            var propertySection = $('.property-section .container');
            propertySection.empty();

            // Reorganize and append the sorted rows with cards
            var currentRow;
            for (var i = 0; i < propertyItems.length; i++) {
                if (i % 3 === 0) {
                    currentRow = $('<div class="row"></div>');
                }
                currentRow.append(propertyItems[i]);
                if ((i + 1) % 3 === 0 || i === propertyItems.length - 1) {
                    propertySection.append(currentRow);
                }
            }
        });
    });
    $(document).ready(function () {
    $('#sortByStatus').on('change', function () {
        var selectedStatus = $(this).val();
        var propertyItems = $('.property-item').toArray();

        propertyItems.sort(function (a, b) {
            var statusA = $(a).find('.type').text().toLowerCase();
            var statusB = $(b).find('.type').text().toLowerCase();

            if (selectedStatus === 'Rent') {
                return statusA === 'rent' ? -1 : 1;
            } else if (selectedStatus === 'Sale') {
                return statusA === 'sale' ? -1 : 1;
            } else {
                // If no status is selected or an incorrect value is provided, retain the original order
                return 0;
            }
        });

        var propertySection = $('.property-section .container');
        propertySection.empty();

        var currentRow;
        for (var i = 0; i < propertyItems.length; i++) {
            if (i % 3 === 0) {
                currentRow = $('<div class="row"></div>');
            }
            currentRow.append(propertyItems[i]);
            if ((i + 1) % 3 === 0 || i === propertyItems.length - 1) {
                propertySection.append(currentRow);
            }
        }
    });
});
$(document).ready(function () {
    $('#sortByStatus').on('change', function () {
        var selectedStatus = $(this).val();
        var propertyItems = $('.property-item');

        propertyItems.each(function () {
            var currentStatus = $(this).find('.type').text().toLowerCase();

            if (selectedStatus === 'Rent' && currentStatus !== 'rent') {
                $(this).hide(); // Hide items that are not 'Rent'
            } else if (selectedStatus === 'Sale' && currentStatus !== 'sale') {
                $(this).hide(); // Hide items that are not 'Sale'
            } else {
                $(this).show(); // Show items matching the selected status
            }
        });
    });
});

</script>



<div th:replace="fragment/footer :: footer"></div>
</body>
</html>